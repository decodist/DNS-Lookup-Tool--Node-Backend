<html>
<head></head>
<body>


<script>
async function fetchWithTimeout(resource, options = {}) {
  const { timeout = 5000 } = options;
  const controller = new AbortController();
  const id = setTimeout(() => controller.abort(), timeout);
  const response = await fetch(resource, {
    ...options,
    signal: controller.signal
  });
  clearTimeout(id);
  return response;
}

async function getLocationData(domain, type, loc) {
	try {
		const response = await fetchWithTimeout('/dns?domain='+domain+'&type='+type+'&loc='+loc, {
		  timeout: 5000
		});
		let json = await response.json();
		return json;
	} catch (error) {
		console.log('timedout');
		return JSON.stringify('Timeout');
	}
}

async function getData() {
	let qdomain = document.getElementById("domainN").value;
	let qrecordfield = document.getElementById("recordT");
	let qrecord = qrecordfield.options[qrecordfield.selectedIndex].value;
	
	let locations = ['US','AU'];
	for (let index = 0; index < locations.length; ++index) {
		let lookupResult = await getLocationData(qdomain, qrecord, locations[index]);
		console.log(locations[index]+' returned '+lookupResult);
		let targetDiv1 = document.getElementById(locations[index]+'-result');
		targetDiv1.innerHTML = lookupResult[0];
	}
	
	
	
	//let targetDiv1 = document.getElementById('dname');
	//targetDiv1.innerHTML = json[0];
	//let targetDiv2 = document.getElementById('dnameip');
	//targetDiv2.innerHTML = json[0]['data'];
}
</script>

<div class="container">
    <form action="../dns" method="get" name="thelookup">
        
            <label for="domainN">Domain</label>
            <input id="domainN" name="domain">
			
			<label for="recordT">Record</label>
			<select name="recordT" id="recordT">
				<option value="A" selected>A</option>
				<option value="NS">NS</option>
				<option value="MX">MX</option>
			</select>
        
        <a href="#" onclick="getData()">Submit!</a>
    </form>
	
	US:
	<div id="US-result"></div>
	
	
	AUS:
	<div id="AU-result"></div>
	
</div>


</body>
</html>